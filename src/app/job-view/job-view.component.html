
<div class="container-fluid">
    <ul class="breadcrumb">
        <li><a href="/">主页</a></li>
        <li>订单</li>
    </ul>

    <div class="row">

    <!--left bar-->
    <div class="col-sm-2">
        <div >
            <mat-form-field>
                <input matInput [matDatepicker]="picker1" placeholder="创建时间" [formControl]="filter['created_date']">
                <mat-datepicker-toggle matSuffix [for]="picker1"></mat-datepicker-toggle>
                <mat-datepicker #picker1></mat-datepicker>
            </mat-form-field>
        </div>
        <div >
            <mat-form-field>
                <input matInput placeholder="公司名称" [formControl]="filter['company_name']">
            </mat-form-field>
        </div>
        <div>
            <mat-form-field>
                <mat-select [formControl]="filter['job_type']" placeholder="业务类型">
                    <mat-option *ngFor="let r of jobTypes" [value]="r.id">
                        {{r.label}}
                    </mat-option>
                </mat-select>
            </mat-form-field>
        </div>
        <div>
            <mat-form-field>
                <mat-select [formControl]="filter['assignee']" placeholder="顾问">
                    <mat-option *ngFor="let r of users" [value]="r.id">
                        {{r.first_name}} {{r.last_name}}
                    </mat-option>
                </mat-select>
            </mat-form-field>
        </div>
        <div>
            <mat-form-field>
                <mat-select [formControl]="filter['is_paid']" placeholder="是否交费">
                    <mat-option [value]='0'>否</mat-option>
                    <mat-option [value]='1'>是</mat-option>
                </mat-select>
            </mat-form-field>
        </div>
        <button mat-raised-button (click)="onSearch()">搜索</button>
        <button mat-raised-button (click)="onClearSearch()">清除</button>
    </div>
    <div class="col-sm-10">
    <!--job list-->
    <div class="row">
        <div class="col-3">
            <button class="btn-add" mat-mini-fab aria-label="添加" (click)="onAdd()">
                <mat-icon aria-label="Add new" class="material-icons">add</mat-icon>
            </button>
        </div>
        <div class="col-9">
            <mat-paginator [length]="length" [pageSize]="pageSize" [pageSizeOptions]="pageSizeOptions"
                (page)="onPaging($event)">
            </mat-paginator>
        </div>

        <table mat-table [dataSource]="pagedJobs" class="mat-elevation-z8 table" *ngIf="!is_loading">
            <ng-container matColumnDef="selected">
                <th mat-header-cell *matHeaderCellDef> </th>
                <td mat-cell *matCellDef="let element">
                    <mat-checkbox></mat-checkbox>
                </td>
            </ng-container>
            <ng-container matColumnDef="created_date">
                <th mat-header-cell *matHeaderCellDef> 创建时间 </th>
                <td mat-cell *matCellDef="let element">
                    <a routerLink="/jobs/edit/{{element.id}}">{{formatDate(element.created_date)}}</a>
                </td>
            </ng-container>
            <ng-container matColumnDef="company_name">
                <th mat-header-cell *matHeaderCellDef> 公司名称 </th>
                <td mat-cell *matCellDef="let element"> {{displayCompanyField(element.customer[0], 'company_name')}}
                </td>
            </ng-container>
            <ng-container matColumnDef="job_type">
                <th mat-header-cell *matHeaderCellDef> 业务类型 </th>
                <td mat-cell *matCellDef="let element"> {{ getJobType(element['type']) }} </td>
            </ng-container>
            <ng-container matColumnDef="assignee">
                <th mat-header-cell *matHeaderCellDef> 顾问姓名 </th>
                <td mat-cell *matCellDef="let element"> {{findUserName(element.customer[0])}} </td>
            </ng-container>
            <ng-container matColumnDef="contact_fullname">
                <th mat-header-cell *matHeaderCellDef> 联系人 </th>
                <td mat-cell *matCellDef="let element"> {{displayCompanyField(element.customer[0], 'contact_fullname')}}
                </td>
            </ng-container>
            <ng-container matColumnDef="is_paid">
                <th mat-header-cell *matHeaderCellDef width="10%"> 是否交费 </th>
                <td mat-cell *matCellDef="let element">
                    <span *ngIf="displayCompanyField(element.customer[0],'is_paid')==1"
                        matTooltip="缴费时间: {{displayPaymentDate(element.customer[0])}}"> 是 </span>
                    <span *ngIf="displayCompanyField(element.customer[0],'is_paid')==0"> 否 </span>
                </td>
            </ng-container>

            <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
            <tr mat-row *matRowDef="let row; columns: displayedColumns;"></tr>
        </table>
        <div class="col-3">

        </div>
        <div class="col-9">
            <mat-paginator [length]="length" [pageSize]="pageSize" [pageSizeOptions]="pageSizeOptions"
                (page)="onPaging($event)">
            </mat-paginator>
        </div>
    </div>
</div>
    <!--//job list-->
    </div>